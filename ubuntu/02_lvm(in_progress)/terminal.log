vagrant@lvm:~$ sudo apt install dump -y
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following NEW packages will be installed:
  dump
0 upgraded, 1 newly installed, 0 to remove and 2 not upgraded.
Need to get 133 kB of archives.
After this operation, 354 kB of additional disk space will be used.
Get:1 http://us.archive.ubuntu.com/ubuntu jammy/universe amd64 dump amd64 0.4b47-3 [133 kB]
Fetched 133 kB in 1s (132 kB/s)
Selecting previously unselected package dump.
(Reading database ... 44187 files and directories currently installed.)
Preparing to unpack .../dump_0.4b47-3_amd64.deb ...
Unpacking dump (0.4b47-3) ...
Setting up dump (0.4b47-3) ...
update-alternatives: using /usr/sbin/rmt-dump to provide /usr/sbin/rmt (rmt) in auto mode
Processing triggers for man-db (2.10.2-1) ...
Scanning processes...                                                                                                                            
Scanning linux images...                                                                                                                         

Running kernel seems to be up-to-date.

No services need to be restarted.

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ lsblk
NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0                       7:0    0 111.9M  1 loop /snap/lxd/24322
loop1                       7:1    0  49.8M  1 loop /snap/snapd/18357
loop2                       7:2    0  63.3M  1 loop /snap/core20/1822
loop3                       7:3    0  63.4M  1 loop /snap/core20/1974
sda                         8:0    0    64G  0 disk 
├─sda1                      8:1    0     1M  0 part 
├─sda2                      8:2    0     2G  0 part /boot
└─sda3                      8:3    0    62G  0 part 
  └─ubuntu--vg-ubuntu--lv 253:0    0    31G  0 lvm  /
sdb                         8:16   0    10G  0 disk 
sdc                         8:32   0     2G  0 disk 
sdd                         8:48   0     1G  0 disk 
sde                         8:64   0     1G  0 disk 
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo vgcreate vg_tmp /dev/sdb
  Volume group "vg_tmp" successfully created
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo lvcreate -n lv_tmp -l +100%FREE /dev/vg_tmp
  Logical volume "lv_tmp" created.
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo vgdisplay -v vg_tmp
  --- Volume group ---
  VG Name               vg_tmp
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  2
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <10.00 GiB
  PE Size               4.00 MiB
  Total PE              2559
  Alloc PE / Size       2559 / <10.00 GiB
  Free  PE / Size       0 / 0   
  VG UUID               u2Ysmp-UBCe-UIl0-qq3K-sx65-opVm-uQpD3s
   
  --- Logical volume ---
  LV Path                /dev/vg_tmp/lv_tmp
  LV Name                lv_tmp
  VG Name                vg_tmp
  LV UUID                L0ySjD-faX4-3fBD-TGNc-4V1o-Ftbq-EUDULg
  LV Write Access        read/write
  LV Creation host, time lvm, 2023-08-08 20:18:51 +0000
  LV Status              available
  # open                 0
  LV Size                <10.00 GiB
  Current LE             2559
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           253:1
   
  --- Physical volumes ---
  PV Name               /dev/sdb     
  PV UUID               94cZgK-80Lb-iFbz-ShAB-9C72-Fhqa-gu8Qnx
  PV Status             allocatable
  Total PE / Free PE    2559 / 0
   
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo mkfs.ext4 /dev/vg_tmp/lv_tmp
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 2620416 4k blocks and 655360 inodes
Filesystem UUID: 491c940c-8c92-44c0-8b8f-f0d899e90fdb
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information: done 

vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo mount /dev/vg_tmp/lv_tmp /mnt
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ df -hT
Filesystem                        Type   Size  Used Avail Use% Mounted on
tmpfs                             tmpfs   97M  1.1M   96M   2% /run
/dev/mapper/ubuntu--vg-ubuntu--lv ext4    31G  3.8G   25G  14% /
tmpfs                             tmpfs  485M     0  485M   0% /dev/shm
tmpfs                             tmpfs  5.0M     0  5.0M   0% /run/lock
/dev/sda2                         ext4   2.0G  131M  1.7G   8% /boot
tmpfs                             tmpfs   97M  4.0K   97M   1% /run/user/1000
/dev/mapper/vg_tmp-lv_tmp         ext4   9.8G   24K  9.3G   1% /mnt
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo fdisk -l /dev/ubuntu-vg/ubuntu-lv
Disk /dev/ubuntu-vg/ubuntu-lv: 31 GiB, 33281802240 bytes, 65003520 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo dump -0u -f /mnt/ubuntu.dump /dev/ubuntu-vg/ubuntu-lv
  DUMP: Date of this level 0 dump: Tue Aug  8 20:22:14 2023
  DUMP: Dumping /dev/ubuntu-vg/ubuntu-lv (an unlisted file system) to /mnt/ubuntu.dump
  DUMP: Label: none
  DUMP: Writing 10 Kilobyte records
  DUMP: mapping (Pass I) [regular files]
  DUMP: mapping (Pass II) [directories]
  DUMP: estimated 4020622 blocks.
  DUMP: Volume 1 started with block 1 at: Tue Aug  8 20:22:14 2023
  DUMP: dumping (Pass III) [directories]
  DUMP: dumping (Pass IV) [regular files]
  DUMP: Closing /mnt/ubuntu.dump
  DUMP: Volume 1 completed at: Tue Aug  8 20:23:04 2023
  DUMP: Volume 1 4017150 blocks (3923.00MB)
  DUMP: Volume 1 took 0:00:50
  DUMP: Volume 1 transfer rate: 80343 kB/s
  DUMP: 4017150 blocks (3923.00MB) on 1 volume(s)
  DUMP: finished in 50 seconds, throughput 80343 kBytes/sec
  DUMP: Date of this level 0 dump: Tue Aug  8 20:22:14 2023
  DUMP: Date this dump completed:  Tue Aug  8 20:23:04 2023
  DUMP: Average transfer rate: 80343 kB/s
  DUMP: DUMP IS DONE
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ cd /mnt
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ ls -l
total 4017172
drwx------ 2 root root      16384 Aug  8 20:20 lost+found
-rw-r--r-- 1 root root 4113561600 Aug  8 20:23 ubuntu.dump
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ sudo restore -rf /mnt/ubuntu.dump
restore: ./lost+found: File exists
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ ls -l
total 6121212
lrwxrwxrwx  1 root root          7 Feb 17 17:19 bin -> usr/bin
drwxr-xr-x  2 root root       4096 Mar 14 02:25 boot
drwxr-xr-x  4 root root       4096 Feb 17 17:23 dev
drwxr-xr-x 98 root root       4096 Aug  8 20:02 etc
drwxr-xr-x  3 root root       4096 Mar 14 02:29 home
lrwxrwxrwx  1 root root          7 Feb 17 17:19 lib -> usr/lib
lrwxrwxrwx  1 root root          9 Feb 17 17:19 lib32 -> usr/lib32
lrwxrwxrwx  1 root root          9 Feb 17 17:19 lib64 -> usr/lib64
lrwxrwxrwx  1 root root         10 Feb 17 17:19 libx32 -> usr/libx32
drwx------  2 root root      16384 Mar 14 02:25 lost+found
drwxr-xr-x  2 root root       4096 Feb 17 17:19 media
drwxr-xr-x  2 root root       4096 Feb 17 17:19 mnt
drwxr-xr-x  3 root root       4096 Mar 14 02:31 opt
drwxr-xr-x  2 root root       4096 Apr 18  2022 proc
-rw-------  1 root root    6981824 Aug  8 20:23 restoresymtable
drwx------  4 root root       4096 Mar 14 02:29 root
drwxr-xr-x 14 root root       4096 Feb 17 17:25 run
lrwxrwxrwx  1 root root          8 Feb 17 17:19 sbin -> usr/sbin
drwxr-xr-x  6 root root       4096 Feb 17 17:25 snap
drwxr-xr-x  2 root root       4096 Feb 17 17:19 srv
-rw-------  1 root root 2147483648 Mar 14 02:27 swap.img
drwxr-xr-x  2 root root       4096 Apr 18  2022 sys
drwxrwxrwt 11 root root       4096 Aug  8 20:12 tmp
-rw-r--r--  1 root root 4113561600 Aug  8 20:23 ubuntu.dump
drwxr-xr-x 14 root root       4096 Feb 17 17:19 usr
drwxr-xr-x 13 root root       4096 Feb 17 17:23 var
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ sudo rm -rf ubuntu.dump
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ sudo mount --bind /proc /mnt/proc
vagrant@lvm:/mnt$ sudo mount --bind /sys /mnt/sys
vagrant@lvm:/mnt$ sudo mount --bind /dev /mnt/dev
vagrant@lvm:/mnt$ sudo mount --bind /run /mnt/run
vagrant@lvm:/mnt$ sudo mount --bind /boot /mnt/boot
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:~$ sudo chroot /mnt/
root@lvm:/# 
root@lvm:/# 
root@lvm:/# chmod -x /etc/grub.d/30_os-prober
root@lvm:/# 
root@lvm:/# 
root@lvm:/# grub-mkconfig -o /boot/grub/grub.cfg
Sourcing file `/etc/default/grub'
Sourcing file `/etc/default/grub.d/init-select.cfg'
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-5.15.0-67-generic
Found initrd image: /boot/initrd.img-5.15.0-67-generic
done
root@lvm:/# 
root@lvm:/# 
root@lvm:/# exit
exit
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo reboot
Connection to 127.0.0.1 closed by remote host

---

vagrant@lvm:~$ lsblk
NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0                       7:0    0  49.8M  1 loop /snap/snapd/18357
loop1                       7:1    0  63.4M  1 loop /snap/core20/1974
loop2                       7:2    0  63.3M  1 loop /snap/core20/1822
loop3                       7:3    0 111.9M  1 loop /snap/lxd/24322
sda                         8:0    0    10G  0 disk 
└─vg_tmp-lv_tmp           253:1    0    10G  0 lvm  /
sdb                         8:16   0     2G  0 disk 
sdc                         8:32   0     1G  0 disk 
sdd                         8:48   0    64G  0 disk 
├─sdd1                      8:49   0     1M  0 part 
├─sdd2                      8:50   0     2G  0 part /boot
└─sdd3                      8:51   0    62G  0 part 
  └─ubuntu--vg-ubuntu--lv 253:0    0    31G  0 lvm  
sde                         8:64   0     1G  0 disk 
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo lvremove /dev/ubuntu-vg/ubuntu-lv 
Do you really want to remove and DISCARD active logical volume ubuntu-vg/ubuntu-lv? [y/n]: y
  Logical volume "ubuntu-lv" successfully removed
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo lvcreate -n ubuntu-lv -L 8G /dev/ubuntu-vg
WARNING: ext4 signature detected on /dev/ubuntu-vg/ubuntu-lv at offset 1080. Wipe it? [y/n]: y
  Wiping ext4 signature on /dev/ubuntu-vg/ubuntu-lv.
  Logical volume "ubuntu-lv" created.
vagrant@lvm:~$ 
vagrant@lvm:~$ 
agrant@lvm:~$ sudo lvs
  LV        VG        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  ubuntu-lv ubuntu-vg -wi-a-----   8.00g                                                    
  lv_tmp    vg_tmp    -wi-ao---- <10.00g                                                    
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo mkfs.ext4 /dev/ubuntu-vg/ubuntu-lv
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 2097152 4k blocks and 524288 inodes
Filesystem UUID: 1b746043-d943-4cbe-b292-1686ca2cddf9
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information: done 

vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo mount /dev/ubuntu-vg/ubuntu-lv /mnt/
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ df -Th
Filesystem                        Type   Size  Used Avail Use% Mounted on
tmpfs                             tmpfs   97M  1.1M   96M   2% /run
/dev/mapper/vg_tmp-lv_tmp         ext4   9.8G  3.8G  5.5G  42% /
tmpfs                             tmpfs  485M     0  485M   0% /dev/shm
tmpfs                             tmpfs  5.0M     0  5.0M   0% /run/lock
/dev/sdd2                         ext4   2.0G  131M  1.7G   8% /boot
tmpfs                             tmpfs   97M  4.0K   97M   1% /run/user/1000
/dev/mapper/ubuntu--vg-ubuntu--lv ext4   7.8G   24K  7.4G   1% /mnt
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo dump -0u -f /mnt/tmp.dump /dev/vg_tmp/lv_tmp 
  DUMP: Date of this level 0 dump: Tue Aug  8 20:37:03 2023
  DUMP: Dumping /dev/vg_tmp/lv_tmp (an unlisted file system) to /mnt/tmp.dump
  DUMP: Label: none
  DUMP: Writing 10 Kilobyte records
  DUMP: mapping (Pass I) [regular files]
  DUMP: mapping (Pass II) [directories]
  DUMP: estimated 4027282 blocks.
  DUMP: Volume 1 started with block 1 at: Tue Aug  8 20:37:03 2023
  DUMP: dumping (Pass III) [directories]
  DUMP: dumping (Pass IV) [regular files]
  DUMP: Closing /mnt/tmp.dump
  DUMP: Volume 1 completed at: Tue Aug  8 20:37:47 2023
  DUMP: Volume 1 4023960 blocks (3929.65MB)
  DUMP: Volume 1 took 0:00:44
  DUMP: Volume 1 transfer rate: 91453 kB/s
  DUMP: 4023960 blocks (3929.65MB) on 1 volume(s)
  DUMP: finished in 44 seconds, throughput 91453 kBytes/sec
  DUMP: Date of this level 0 dump: Tue Aug  8 20:37:03 2023
  DUMP: Date this dump completed:  Tue Aug  8 20:37:47 2023
  DUMP: Average transfer rate: 91453 kB/s
  DUMP: DUMP IS DONE
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ cd /mnt/
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ ls -l
total 4023980
drwx------ 2 root root      16384 Aug  8 20:34 lost+found
-rw-r--r-- 1 root root 4120535040 Aug  8 20:37 tmp.dump
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ sudo restore -rf /mnt/tmp.dump
restore: ./lost+found: File exists
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ ls -l
total 6125872
lrwxrwxrwx  1 root root          7 Feb 17 17:19 bin -> usr/bin
drwxr-xr-x  2 root root       4096 Mar 14 02:25 boot
drwxr-xr-x  4 root root       4096 Feb 17 17:23 dev
drwxr-xr-x 98 root root       4096 Aug  8 20:02 etc
drwxr-xr-x  3 root root       4096 Mar 14 02:29 home
lrwxrwxrwx  1 root root          7 Feb 17 17:19 lib -> usr/lib
lrwxrwxrwx  1 root root          9 Feb 17 17:19 lib32 -> usr/lib32
lrwxrwxrwx  1 root root          9 Feb 17 17:19 lib64 -> usr/lib64
lrwxrwxrwx  1 root root         10 Feb 17 17:19 libx32 -> usr/libx32
drwx------  2 root root      16384 Mar 14 02:25 lost+found
drwxr-xr-x  2 root root       4096 Feb 17 17:19 media
drwxr-xr-x  2 root root       4096 Feb 17 17:19 mnt
drwxr-xr-x  3 root root       4096 Mar 14 02:31 opt
drwxr-xr-x  2 root root       4096 Apr 18  2022 proc
-rw-------  1 root root    4780336 Aug  8 20:39 restoresymtable
drwx------  4 root root       4096 Aug  8 20:27 root
drwxr-xr-x 14 root root       4096 Feb 17 17:25 run
lrwxrwxrwx  1 root root          8 Feb 17 17:19 sbin -> usr/sbin
drwxr-xr-x  6 root root       4096 Feb 17 17:25 snap
drwxr-xr-x  2 root root       4096 Feb 17 17:19 srv
-rw-------  1 root root 2147483648 Mar 14 02:27 swap.img
drwxr-xr-x  2 root root       4096 Apr 18  2022 sys
drwxrwxrwt 11 root root       4096 Aug  8 20:34 tmp
-rw-r--r--  1 root root 4120535040 Aug  8 20:37 tmp.dump
drwxr-xr-x 14 root root       4096 Feb 17 17:19 usr
drwxr-xr-x 13 root root       4096 Feb 17 17:23 var
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ sudo rm -rf tmp.dump
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ sudo mount --bind /proc /mnt/proc
vagrant@lvm:/mnt$ sudo mount --bind /sys /mnt/sys
vagrant@lvm:/mnt$ sudo mount --bind /dev /mnt/dev
vagrant@lvm:/mnt$ sudo mount --bind /run /mnt/run
vagrant@lvm:/mnt$ sudo mount --bind /boot /mnt/boot
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ sudo chroot /mnt/
root@lvm:/# 
root@lvm:/# 
root@lvm:/# grub-mkconfig -o /boot/grub/grub.cfg
Sourcing file `/etc/default/grub'
Sourcing file `/etc/default/grub.d/init-select.cfg'
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-5.15.0-67-generic
Found initrd image: /boot/initrd.img-5.15.0-67-generic
done
root@lvm:/# 
root@lvm:/# 
oot@lvm:/# exit
exit
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ 
vagrant@lvm:/mnt$ sudo reboot
Connection to 127.0.0.1 closed by remote host.

---

vagrant@lvm:~$ lsblk
NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0                       7:0    0  63.3M  1 loop /snap/core20/1822
loop1                       7:1    0  49.8M  1 loop /snap/snapd/18357
loop2                       7:2    0 111.9M  1 loop /snap/lxd/24322
loop3                       7:3    0  63.4M  1 loop /snap/core20/1974
sda                         8:0    0    64G  0 disk 
├─sda1                      8:1    0     1M  0 part 
├─sda2                      8:2    0     2G  0 part /boot
└─sda3                      8:3    0    62G  0 part 
  └─ubuntu--vg-ubuntu--lv 253:1    0     8G  0 lvm  /
sdb                         8:16   0    10G  0 disk 
└─vg_tmp-lv_tmp           253:0    0    10G  0 lvm  
sdc                         8:32   0     2G  0 disk 
sdd                         8:48   0     1G  0 disk 
sde                         8:64   0     1G  0 disk 
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo lvremove /dev/vg_tmp/lv_tmp 
Do you really want to remove and DISCARD active logical volume vg_tmp/lv_tmp? [y/n]: y
  Logical volume "lv_tmp" successfully removed
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo vgremove vg_tmp
  Volume group "vg_tmp" successfully removed
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo pvremove /dev/sdb
  Labels on physical volume "/dev/sdb" successfully wiped.
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ lsblk 
NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0                       7:0    0  63.3M  1 loop /snap/core20/1822
loop1                       7:1    0  49.8M  1 loop /snap/snapd/18357
loop2                       7:2    0 111.9M  1 loop /snap/lxd/24322
loop3                       7:3    0  63.4M  1 loop /snap/core20/1974
sda                         8:0    0    64G  0 disk 
├─sda1                      8:1    0     1M  0 part 
├─sda2                      8:2    0     2G  0 part /boot
└─sda3                      8:3    0    62G  0 part 
  └─ubuntu--vg-ubuntu--lv 253:1    0     8G  0 lvm  /
sdb                         8:16   0    10G  0 disk 
sdc                         8:32   0     2G  0 disk 
sdd                         8:48   0     1G  0 disk 
sde                         8:64   0     1G  0 disk 
vagrant@lvm:~$ 
vagrant@lvm:~$ 
vagrant@lvm:~$ sudo -i
root@lvm:~# 
root@lvm:~#
root@lvm:~# pvcreate /dev/sdc /dev/sdd
  Physical volume "/dev/sdc" successfully created.
  Physical volume "/dev/sdd" successfully created.
root@lvm:~# 
root@lvm:~# 
root@lvm:~# vgcreate vg_var /dev/sdc /dev/sdd
  Volume group "vg_var" successfully created
root@lvm:~# 
root@lvm:~# 
root@lvm:~# lvcreate -L 950M -m1 -n lv_var vg_var
  Rounding up size to full physical extent 952.00 MiB
  Logical volume "lv_var" created.
root@lvm:~# 
root@lvm:~# 
root@lvm:~# mkfs.ext4 /dev/vg_var/lv_var
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 243712 4k blocks and 60928 inodes
Filesystem UUID: e5885b24-a4b0-4375-b7bc-88283e27f60d
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: done

root@lvm:~# 
root@lvm:~# 
root@lvm:~# mount /dev/vg_var/lv_var /mnt
root@lvm:~# 
root@lvm:~# 
root@lvm:~# cp -aR /var/* /mnt/ # rsync -avHPSAX /var/ /mnt/
root@lvm:~# 
root@lvm:~# 
root@lvm:~# ls -l /mnt/
total 60
drwxr-xr-x  2 root root    4096 Apr 18  2022 backups
drwxr-xr-x 13 root root    4096 Aug  8 20:12 cache
drwxrwxrwt  2 root root    4096 Feb 17 17:23 crash
drwxr-xr-x 38 root root    4096 Aug  8 20:09 lib
drwxrwsr-x  2 root staff   4096 Apr 18  2022 local
lrwxrwxrwx  1 root root       9 Feb 17 17:19 lock -> /run/lock
drwxrwxr-x  7 root syslog  4096 Aug  8 20:43 log
drwx------  2 root root   16384 Aug  8 20:56 lost+found
drwxrwsr-x  2 root mail    4096 Feb 17 17:19 mail
drwxr-xr-x  2 root root    4096 Feb 17 17:19 opt
lrwxrwxrwx  1 root root       4 Feb 17 17:19 run -> /run
drwxr-xr-x  5 root root    4096 Feb 17 17:25 snap
drwxr-xr-x  4 root root    4096 Feb 17 17:24 spool
drwxrwxrwt  5 root root    4096 Aug  8 20:48 tmp
root@lvm:~# 
root@lvm:~# 
root@lvm:~# mkdir /tmp/oldvar && mv /var/* /tmp/oldvar
root@lvm:~# 
root@lvm:~# 
root@lvm:~# umount /mnt
root@lvm:~# 
root@lvm:~# 
root@lvm:~# mount /dev/vg_var/lv_var /var
root@lvm:~# 
root@lvm:~# 
root@lvm:~# echo "`blkid | grep var: | awk '{print $2}'` /var ext4 defaults 0 0" >> /etc/fstab
root@lvm:~# 
root@lvm:~# 
root@lvm:~# cat /etc/fstab 
# /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# <file system> <mount point>   <type>  <options>       <dump>  <pass>
# / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation
/dev/disk/by-id/dm-uuid-LVM-Yk4DibxWKO79hebBzeGfuwkx7J5of11iY68R4fVIy7zCJJJgAkt0MvPx5rLORxGd / ext4 defaults 0 1
# /boot was on /dev/sda2 during curtin installation
/dev/disk/by-uuid/dbade222-4031-44a3-8126-76bd9b33e01e /boot ext4 defaults 0 1
/swap.img       none    swap    sw      0       0
#VAGRANT-BEGIN
# The contents below are automatically generated by Vagrant. Do not modify.
#VAGRANT-END
UUID="e5885b24-a4b0-4375-b7bc-88283e27f60d" /var ext4 defaults 0 0
root@lvm:~# 
root@lvm:~# 
root@lvm:~# df -Th
Filesystem                        Type   Size  Used Avail Use% Mounted on
tmpfs                             tmpfs   97M  1.1M   96M   2% /run
/dev/mapper/ubuntu--vg-ubuntu--lv ext4   7.8G  3.9G  3.6G  52% /
tmpfs                             tmpfs  485M     0  485M   0% /dev/shm
tmpfs                             tmpfs  5.0M     0  5.0M   0% /run/lock
/dev/sda2                         ext4   2.0G  131M  1.7G   8% /boot
tmpfs                             tmpfs   97M  4.0K   97M   1% /run/user/1000
/dev/mapper/vg_var-lv_var         ext4   919M  603M  253M  71% /var
root@lvm:~# 
root@lvm:~# 
root@lvm:~# lsblk
NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0                       7:0    0  63.3M  1 loop /snap/core20/1822
loop1                       7:1    0  49.8M  1 loop /snap/snapd/18357
loop2                       7:2    0 111.9M  1 loop /snap/lxd/24322
loop3                       7:3    0  63.4M  1 loop /snap/core20/1974
sda                         8:0    0    64G  0 disk 
├─sda1                      8:1    0     1M  0 part 
├─sda2                      8:2    0     2G  0 part /boot
└─sda3                      8:3    0    62G  0 part 
  └─ubuntu--vg-ubuntu--lv 253:1    0     8G  0 lvm  /
sdb                         8:16   0    10G  0 disk 
sdc                         8:32   0     2G  0 disk 
├─vg_var-lv_var_rmeta_0   253:0    0     4M  0 lvm  
│ └─vg_var-lv_var         253:5    0   952M  0 lvm  /var
└─vg_var-lv_var_rimage_0  253:2    0   952M  0 lvm  
  └─vg_var-lv_var         253:5    0   952M  0 lvm  /var
sdd                         8:48   0     1G  0 disk 
├─vg_var-lv_var_rmeta_1   253:3    0     4M  0 lvm  
│ └─vg_var-lv_var         253:5    0   952M  0 lvm  /var
└─vg_var-lv_var_rimage_1  253:4    0   952M  0 lvm  
  └─vg_var-lv_var         253:5    0   952M  0 lvm  /var
sde                         8:64   0     1G  0 disk 
root@lvm:~# 
root@lvm:~# 
root@lvm:~# pvcreate /dev/sde 
  Physical volume "/dev/sde" successfully created.
root@lvm:~# 
root@lvm:~# 
root@lvm:~# vgcreate vg_home  /dev/sde 
  Volume group "vg_home" successfully created
root@lvm:~# 
root@lvm:~# 
root@lvm:~# lvcreate -n lv_home -l +50%FREE /dev/vg_home
  Logical volume "lv_home" created.
root@lvm:~# 
root@lvm:~# 
root@lvm:~# mkfs.ext4 /dev/vg_home/lv_home
mke2fs 1.46.5 (30-Dec-2021)
Creating filesystem with 261120 4k blocks and 65280 inodes
Filesystem UUID: 04c0536c-d7bc-4d75-a690-dfb32a07de0d
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: done

root@lvm:~# 
root@lvm:~# 
root@lvm:~# mount /dev/vg_home/lv_home /mnt
root@lvm:~# 
root@lvm:~# 
root@lvm:~# touch /home/vagrant/file{1..20}
root@lvm:~# 
root@lvm:~# 
root@lvm:~# cp -aR /home/* /mnt/ 
root@lvm:~# 
root@lvm:~# 
root@lvm:~# rm -rf /home/* 
root@lvm:~# 
root@lvm:~# 
root@lvm:~# ls -l /home/
total 0
root@lvm:~# 
root@lvm:~# 
root@lvm:~# ls -l /mnt/vagrant/
total 0
-rw-r--r-- 1 root root 0 Aug  8 21:09 file1
-rw-r--r-- 1 root root 0 Aug  8 21:09 file10
-rw-r--r-- 1 root root 0 Aug  8 21:09 file11
-rw-r--r-- 1 root root 0 Aug  8 21:09 file12
-rw-r--r-- 1 root root 0 Aug  8 21:09 file13
-rw-r--r-- 1 root root 0 Aug  8 21:09 file14
-rw-r--r-- 1 root root 0 Aug  8 21:09 file15
-rw-r--r-- 1 root root 0 Aug  8 21:09 file16
-rw-r--r-- 1 root root 0 Aug  8 21:09 file17
-rw-r--r-- 1 root root 0 Aug  8 21:09 file18
-rw-r--r-- 1 root root 0 Aug  8 21:09 file19
-rw-r--r-- 1 root root 0 Aug  8 21:09 file2
-rw-r--r-- 1 root root 0 Aug  8 21:09 file20
-rw-r--r-- 1 root root 0 Aug  8 21:09 file3
-rw-r--r-- 1 root root 0 Aug  8 21:09 file4
-rw-r--r-- 1 root root 0 Aug  8 21:09 file5
-rw-r--r-- 1 root root 0 Aug  8 21:09 file6
-rw-r--r-- 1 root root 0 Aug  8 21:09 file7
-rw-r--r-- 1 root root 0 Aug  8 21:09 file8
-rw-r--r-- 1 root root 0 Aug  8 21:09 file9
root@lvm:~# 
root@lvm:~# 
root@lvm:~# umount /mnt
root@lvm:~# 
root@lvm:~# 
root@lvm:~# mount /dev/vg_home/lv_home /home/
root@lvm:~# 
root@lvm:~# 
root@lvm:~# ls -l /home/vagrant/
total 0
-rw-r--r-- 1 root root 0 Aug  8 21:09 file1
-rw-r--r-- 1 root root 0 Aug  8 21:09 file10
-rw-r--r-- 1 root root 0 Aug  8 21:09 file11
-rw-r--r-- 1 root root 0 Aug  8 21:09 file12
-rw-r--r-- 1 root root 0 Aug  8 21:09 file13
-rw-r--r-- 1 root root 0 Aug  8 21:09 file14
-rw-r--r-- 1 root root 0 Aug  8 21:09 file15
-rw-r--r-- 1 root root 0 Aug  8 21:09 file16
-rw-r--r-- 1 root root 0 Aug  8 21:09 file17
-rw-r--r-- 1 root root 0 Aug  8 21:09 file18
-rw-r--r-- 1 root root 0 Aug  8 21:09 file19
-rw-r--r-- 1 root root 0 Aug  8 21:09 file2
-rw-r--r-- 1 root root 0 Aug  8 21:09 file20
-rw-r--r-- 1 root root 0 Aug  8 21:09 file3
-rw-r--r-- 1 root root 0 Aug  8 21:09 file4
-rw-r--r-- 1 root root 0 Aug  8 21:09 file5
-rw-r--r-- 1 root root 0 Aug  8 21:09 file6
-rw-r--r-- 1 root root 0 Aug  8 21:09 file7
-rw-r--r-- 1 root root 0 Aug  8 21:09 file8
-rw-r--r-- 1 root root 0 Aug  8 21:09 file9
root@lvm:~# 
root@lvm:~# 
root@lvm:~# echo "`blkid | grep Home | awk '{print $2}'` /home ext4 defaults 0 0" >> /etc/fstab
root@lvm:~# 
root@lvm:~# 
root@lvm:~# cat /etc/fstab 
# /etc/fstab: static file system information.
#
# Use 'blkid' to print the universally unique identifier for a
# device; this may be used with UUID= as a more robust way to name devices
# that works even if disks are added and removed. See fstab(5).
#
# <file system> <mount point>   <type>  <options>       <dump>  <pass>
# / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation
/dev/disk/by-id/dm-uuid-LVM-Yk4DibxWKO79hebBzeGfuwkx7J5of11iY68R4fVIy7zCJJJgAkt0MvPx5rLORxGd / ext4 defaults 0 1
# /boot was on /dev/sda2 during curtin installation
/dev/disk/by-uuid/dbade222-4031-44a3-8126-76bd9b33e01e /boot ext4 defaults 0 1
/swap.img       none    swap    sw      0       0
#VAGRANT-BEGIN
# The contents below are automatically generated by Vagrant. Do not modify.
#VAGRANT-END
UUID="e5885b24-a4b0-4375-b7bc-88283e27f60d" /var ext4 defaults 0 0
 /home ext4 defaults 0 0
root@lvm:~# 
root@lvm:~# 
root@lvm:~# lvcreate -L 100MB -s -n home_snap /dev/vg_home/lv_home 
  Logical volume "home_snap" created.
root@lvm:~# 
root@lvm:~# 
root@lvm:~# rm -f /home/vagrant/file{11..20} 
root@lvm:~# 
root@lvm:~# 
root@lvm:~# ls -l /home/vagrant/
total 0
-rw-r--r-- 1 root root 0 Aug  8 21:52 file1
-rw-r--r-- 1 root root 0 Aug  8 21:52 file10
-rw-r--r-- 1 root root 0 Aug  8 21:52 file2
-rw-r--r-- 1 root root 0 Aug  8 21:52 file3
-rw-r--r-- 1 root root 0 Aug  8 21:52 file4
-rw-r--r-- 1 root root 0 Aug  8 21:52 file5
-rw-r--r-- 1 root root 0 Aug  8 21:52 file6
-rw-r--r-- 1 root root 0 Aug  8 21:52 file7
-rw-r--r-- 1 root root 0 Aug  8 21:52 file8
-rw-r--r-- 1 root root 0 Aug  8 21:52 file9
root@lvm:~# 
root@lvm:~# 
root@lvm:~# lvconvert --merge /dev/vg_home/home_snap 
  Merging of volume vg_home/home_snap started.
  vg_home/lv_home: Merged: 100.00%
root@lvm:~# 
root@lvm:~# 
root@lvm:~# mount /dev/vg_home/lv_home /home
root@lvm:~# 
root@lvm:~# 
root@lvm:~# 
root@lvm:~# ls -l /home/vagrant/
total 0
-rw-r--r-- 1 root root 0 Aug  8 21:52 file1
-rw-r--r-- 1 root root 0 Aug  8 21:52 file10
-rw-r--r-- 1 root root 0 Aug  8 21:52 file11
-rw-r--r-- 1 root root 0 Aug  8 21:52 file12
-rw-r--r-- 1 root root 0 Aug  8 21:52 file13
-rw-r--r-- 1 root root 0 Aug  8 21:52 file14
-rw-r--r-- 1 root root 0 Aug  8 21:52 file15
-rw-r--r-- 1 root root 0 Aug  8 21:52 file16
-rw-r--r-- 1 root root 0 Aug  8 21:52 file17
-rw-r--r-- 1 root root 0 Aug  8 21:52 file18
-rw-r--r-- 1 root root 0 Aug  8 21:52 file19
-rw-r--r-- 1 root root 0 Aug  8 21:52 file2
-rw-r--r-- 1 root root 0 Aug  8 21:52 file20
-rw-r--r-- 1 root root 0 Aug  8 21:52 file3
-rw-r--r-- 1 root root 0 Aug  8 21:52 file4
-rw-r--r-- 1 root root 0 Aug  8 21:52 file5
-rw-r--r-- 1 root root 0 Aug  8 21:52 file6
-rw-r--r-- 1 root root 0 Aug  8 21:52 file7
-rw-r--r-- 1 root root 0 Aug  8 21:52 file8
-rw-r--r-- 1 root root 0 Aug  8 21:52 file9
root@lvm:~# 
root@lvm:~# 
root@lvm:~# shutdown -h now
Connection to 127.0.0.1 closed by remote host.

